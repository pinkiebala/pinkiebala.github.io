<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 2.24.91"/><title data-react-helmet="true"></title><link rel="icon" href="/favicon-32x32.png?v=4a9773549091c227cd2eb82ccd9c5e3a" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link as="script" rel="preload" href="/webpack-runtime-62b33b9d9b306650c6cd.js"/><link as="script" rel="preload" href="/framework-cc03bb45506d81428ff3.js"/><link as="script" rel="preload" href="/app-b07e8a927c1699312da5.js"/><link as="script" rel="preload" href="/component---src-templates-blog-tsx-97d2206dcfc647912165.js"/><link as="fetch" rel="preload" href="/page-data/posts/LCP/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="blog-post-container"><div class="blog-post"><h1>LCP 最大內容繪製</h1><h2>November 02, 2020</h2><div class="blog-post-content"><h1>LCP (Largeset Contentful Paint)</h1>
<p>最大內容繪製，版面上最有代表性、面積最大的區塊，通常是封面圖，當他繪製完成的時候就是 LCP。</p>
<p>如何讓首圖更快載入就是 LCP 的重點。</p>
<p>後端大大可以幫你的，用比較先進的圖片壓縮 (e.g webp)、用比較快的 CDN serve 靜態檔案、架設動態壓圖的伺服器讓你搭配 srcset。</p>
<p>前端這邊可以做 <a href="https://developer.mozilla.org/en-US/docs/Learn/HTML/Multimedia_and_embedding/Responsive_images">responsive-image</a> 設定 srcset, sizes 盡可能載剛剛好的圖片，減少不必要的傳輸浪費，再搭配 <code>&#x3C;head></code> 裡 preload 封面圖，就算是 srcset 也是可以做 preload 的，
見 <a href="https://web.dev/preload-responsive-images/">preload-responsive-images</a></p>
<h2>補充細節</h2>
<h3>sizes 的陷阱</h3>
<p><code>sizes="(min-width: 768px) 700w, (min-width:992px) 900w, 500w"</code></p>
<p>螢幕寬度 1200px，他會載到哪一張圖呢？答案是 700w，竟然不是 900w?!，他找到第一個 match 的 media query 就會 return 了，要小心。</p>
<p>參考：<a href="https://developer.mozilla.org/en-US/docs/Learn/HTML/Multimedia_and_embedding/Responsive_images">MDN 的 Note</a></p>
<blockquote>
<p>The browser ignores everything after the first matching condition, so be careful how you order the media conditions.</p>
</blockquote>
<h3>模糊小圖拉大，無效</h3>
<p>蠻多社群網站會先載一張小圖，拉到跟原圖一樣大，並搭配 CSS blur 做 placeholder，稍後把原圖載進來再用 transition 做置換，個人認為這樣的使用者體驗還不錯。但這種作法根據 <a href="https://web.dev/lcp/">web.dev</a> 對於 LCP 講解的文章中的這段，我自己也試過，是無效的。覺得有點怪又有點可惜，不知道之後會不會改。</p>
<blockquote>
<p>For example, images that are shrunk down to a much smaller than their intrinsic size will only report the size they're displayed at, whereas images that are stretched or expanded to a larger size will only report their intrinsic sizes.</p>
</blockquote>
<h3>data url 放 svg，有效</h3>
<p>個人試過在 img <code>src</code> 的地方寫 data url 用一個 1px*1px 的 svg 拉成原圖尺寸，跟圖片重疊，是可以被當作 LCP 的，這個實驗是在 Lighthouse 6，我覺得是 BUG，不知道之後會不會被修正 XD</p>
<pre><code class="language-jsx">&#x3C;img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='1' height='1' viewBox='0 0 1 1'%3E%3Crect width='100%25' height='100%25' fill='transparent'%3E%3C/rect%3E%3C/svg%3E"
</code></pre>
<p>因為我都有做 aspect-ratio-box 所以把上面這張圖一樣 <code>position: absolute</code>, 長寬 100% 就好了</p>
<h3>避免 HTML parsing 被中斷</h3>
<p>可以用 chrome devtool performance 錄製網站載入的過程，注意 HTML parsing 有沒有因為一些 inline script 或是 async script 中斷，這些會讓首圖的 HTML 沒有那麼快畫出來，而拖慢 LCP，同時 layout 一直重新計算，也會拖到一點 TBT。不過讓 HTML 一氣喝成 parsing 完的話，FCP 會因此變慢，所以最後對於網站效能分數的影響還有待釐清。</p></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/posts/LCP";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-01365ee183870cafc13e.js"],"app":["/app-b07e8a927c1699312da5.js"],"component---src-pages-404-js":["/component---src-pages-404-js-9c04155390b493ad90ef.js"],"component---src-pages-index-js":["/component---src-pages-index-js-0e8324ce760316d589ed.js"],"component---src-pages-page-2-js":["/component---src-pages-page-2-js-6f9304e8e0b72f58449a.js"],"component---src-pages-using-typescript-tsx":["/component---src-pages-using-typescript-tsx-d51a13ff025a3ef04cea.js"],"component---src-templates-blog-tsx":["/component---src-templates-blog-tsx-97d2206dcfc647912165.js"]};/*]]>*/</script><script src="/polyfill-01365ee183870cafc13e.js" nomodule=""></script><script src="/component---src-templates-blog-tsx-97d2206dcfc647912165.js" async=""></script><script src="/app-b07e8a927c1699312da5.js" async=""></script><script src="/framework-cc03bb45506d81428ff3.js" async=""></script><script src="/webpack-runtime-62b33b9d9b306650c6cd.js" async=""></script></body></html>